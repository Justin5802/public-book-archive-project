<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Get Recommendations | Public Book Archive</title>
  <link rel="stylesheet" href="/css/style.css">
  <!-- Turn.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.1/turn.min.css">
  <style>
    body {
      background: #f5f5f5;
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 {
      color: #3a3a3a;
      font-size: 2.5em;
    }
    #quiz-book {
      width: 1000px;
      height: 650px;
      margin: 0 auto;
    }
    .quiz-page {
      background: white;
      padding: 40px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      height: 150%;
      box-sizing: border-box;
      position: relative;
    }
    .quiz-page h2 {
      text-align: center;
      color: #5a3e36;
      margin-bottom: 40px;
      font-size: 1.8em;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 25px;
      margin-bottom: 40px;
    }
    .option-card {
      width: 140spx;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .option-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .option-card input[type="radio"] {
      display: none;
    }
    .option-card input[type="radio"]:checked + .option-content {
      background-color: #f0e6dd;
      border-color: #5a3e36;
    }
    .option-content {
      padding: 10px;
      border-radius: 8px;
      border: 2px solid transparent;
      height: 100%;
    }
    .option-content h3 {
      margin-top: 0;
      color: #5a3e36;
      font-size: 1em;
      margin-bottom: 5;
    }
    .option-content p {
      color: #666;
      font-size: 0.9em;
      line-height: 1.3;
    }
    select {
      width: 60%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1.1em;
      margin: 30px auto;
      display: block;
    }
    .page-controls {
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      text-align: center;
    }
    .page-btn {
      padding: 12px 25px;
      margin: 0 15px;
      background: #5a3e36;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.3s;
      min-width: 120px;
    }
    .page-btn:hover {
      background: #3a2a24;
    }
    .page-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    .recommendations-container {
      text-align: center;
      margin-top: 30px;
    }
    .recommendations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
      margin: 40px 0;
    }
    .page-indicator {
      position: absolute;
      bottom: 35px;
      left: 0;
      right: 0;
      text-align: center;
      color: #777;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Book Recommendation Quiz</h1>
      <p>Answer a few questions to get personalized book suggestions</p>
    </header>
    
    <main>
      <div id="quiz-book">
        <!-- Page 1: Mood -->
        <div class="quiz-page">
          <h2>What's your current mood?</h2>
          <div class="options">
            <label class="option-card">
              <input type="radio" name="mood" value="happy" required>
              <div class="option-content">
                <h3>Happy/Upbeat</h3>
                <p>Looking for something light and cheerful to brighten my day</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="mood" value="thoughtful">
              <div class="option-content">
                <h3>Thoughtful/Reflective</h3>
                <p>Want something meaningful that will make me think deeply</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="mood" value="adventurous">
              <div class="option-content">
                <h3>Adventurous</h3>
                <p>Ready for an exciting journey full of action and discovery</p>
              </div>
            </label>
          </div>
          <div class="page-indicator">Page 1 of 4</div>
          <div class="page-controls">
            <button type="button" class="page-btn next-btn">Next →</button>
          </div>
        </div>
        
        <!-- Page 2: Reading Pace -->
        <div class="quiz-page">
          <h2>What reading pace do you prefer?</h2>
          <div class="options">
            <label class="option-card">
              <input type="radio" name="pace" value="fast" required>
              <div class="option-content">
                <h3>Fast-paced</h3>
                <p>Page-turners with quick action that keep me hooked</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="pace" value="slow">
              <div class="option-content">
                <h3>Slow and steady</h3>
                <p>Beautiful prose that I can savor and enjoy gradually</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="pace" value="varied">
              <div class="option-content">
                <h3>It depends</h3>
                <p>I enjoy both fast-paced thrillers and slow literary works</p>
              </div>
            </label>
          </div>
          <div class="page-indicator">Page 2 of 4</div>
          <div class="page-controls">
            <button type="button" class="page-btn prev-btn">← Back</button>
            <button type="button" class="page-btn next-btn">Next →</button>
          </div>
        </div>
        
        <!-- Page 3: Book Length -->
        <div class="quiz-page">
          <h2>How long of a book do you prefer?</h2>
          <div class="options">
            <label class="option-card">
              <input type="radio" name="length" value="short" required>
              <div class="option-content">
                <h3>Short (under 300 pages)</h3>
                <p>Something I can finish in a few sittings</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="length" value="medium">
              <div class="option-content">
                <h3>Medium (300-500 pages)</h3>
                <p>A satisfying story that doesn't feel overwhelming</p>
              </div>
            </label>
            
            <label class="option-card">
              <input type="radio" name="length" value="long">
              <div class="option-content">
                <h3>Long (500+ pages)</h3>
                <p>I want to fully immerse myself in a detailed world</p>
              </div>
            </label>
          </div>
          <div class="page-indicator">Page 3 of 4</div>
          <div class="page-controls">
            <button type="button" class="page-btn prev-btn">← Back</button>
            <button type="button" class="page-btn next-btn">Next →</button>
          </div>
        </div>
        
        <!-- Page 4: Genre -->
        <div class="quiz-page">
          <h2>What genre are you in the mood for?</h2>
          <div class="options">
            <select name="genre" required>
              <option value="">Select a genre</option>
              <option value="Fiction">Literary Fiction</option>
              <option value="Non-Fiction">Non-Fiction</option>
              <option value="Science Fiction">Science Fiction</option>
              <option value="Fantasy">Fantasy</option>
              <option value="Mystery">Mystery/Thriller</option>
              <option value="Romance">Romance</option>
              <option value="Horror">Horror</option>
              <option value="Historical Fiction">Historical Fiction</option>
              <option value="Biography">Biography</option>
              <option value="Memoir">Memoir</option>
              <option value="Poetry">Poetry</option>
              <option value="Young Adult">Young Adult</option>
            </select>
          </div>
          <div class="page-indicator">Page 4 of 4</div>
          <div class="page-controls">
            <button type="button" class="page-btn prev-btn">← Back</button>
            <button type="button" class="page-btn" id="submit-quiz">Get Recommendations</button>
          </div>
        </div>
      </div>
      
      <div id="recommendations" class="recommendations-container" style="display: none;">
        <h2>Recommended For You</h2>
        <div class="recommendations-grid" id="recommendationsGrid">
          <!-- Recommendations will be inserted here -->
        </div>
        <a href="/archive" class="page-btn" style="display: inline-block; text-decoration: none;">Browse All Reviews</a>
      </div>
    </main>
  </div>
  
  <!-- jQuery and Turn.js libraries -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/turn.min.js"></script>
  
  <script>
  $(document).ready(function() {
    $('#quiz-book').turn({
      width: 1000,
      height: 650,
      autoCenter: true,
      duration: 600
    });

    updateButtonStates();

    $('.next-btn').click(function() {
      if (validateCurrentPage()) {
        $('#quiz-book').turn('next');
        updateButtonStates();
      }
    });

    $('.prev-btn').click(function() {
      $('#quiz-book').turn('previous');
      updateButtonStates();
    });

    $('#submit-quiz').click(async function() {
  if (validateCurrentPage()) {
    // Collect all quiz answers
    const quizData = {
      mood: $('input[name="mood"]:checked').val(),
      pace: $('input[name="pace"]:checked').val(),
      length: $('input[name="length"]:checked').val(),
      genre: $('select[name="genre"]').val()
    };

    try {
      // Send quiz data to server
      const response = await fetch('/api/recommend', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(quizData)
      });

      if (response.ok) {
        const recommendations = await response.json();
        displayRecommendations(recommendations);
        
        // Show recommendations and hide quiz
        $('#quiz-book').hide();
        $('#recommendations').show();
      } else {
        const error = await response.json();
        alert(`Error: ${error.error}`);
      }
    } catch (err) {
      alert('An error occurred. Please try again.');
      console.error(err);
    }
  }
});

    $(document).keydown(function(e) {
      if (e.keyCode == 37) {
        $('#quiz-book').turn('previous');
        updateButtonStates();
        e.preventDefault();
      } else if (e.keyCode == 39) {
        if (validateCurrentPage()) {
          $('#quiz-book').turn('next');
          updateButtonStates();
          e.preventDefault();
        }
      }
    });

    function validateCurrentPage() {
      const currentPage = $('#quiz-book').turn('page');

      if (currentPage === 1 && $('input[name="mood"]:checked').length === 0) {
        alert('Please select your current mood');
        return false;
      } else if (currentPage === 2 && $('input[name="pace"]:checked').length === 0) {
        alert('Please select your preferred reading pace');
        return false;
      } else if (currentPage === 3 && $('input[name="length"]:checked').length === 0) {
        alert('Please select your preferred book length');
        return false;
      } else if (currentPage === 4 && $('select[name="genre"]').val() === '') {
        alert('Please select a genre');
        return false;
      }
      return true;
    }

    function updateButtonStates() {
      const currentPage = $('#quiz-book').turn('page');
      const totalPages = $('#quiz-book').turn('pages');

      $('.prev-btn').toggle(currentPage > 1);
      $('.next-btn').toggle(currentPage < totalPages);
      $('#submit-quiz').toggle(currentPage === totalPages);
    }
  });
</script>
<script src="/js/app.js"></script>
</body>
</html>
